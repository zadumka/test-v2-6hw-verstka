"""
Перевірка: Посиланням контактів на планшеті задані паддінги,
через що відступ та висота хедера не відповідає макету.

На брейкпойнті 768–1157px `.contacts-link` (або аналогічний селектор)
НЕ повинен мати вертикальних паддінгів (padding-top / padding-bottom).
Вертикальний padding з'являється лише на ≥1158px (padding: 24px 0).
"""

from playwright.sync_api import sync_playwright

TABLET_WIDTH = 768
TABLET_HEIGHT = 1024

# Селектори, які студенти можуть використовувати для контактних посилань
CONTACTS_LINK_SELECTORS = [
    ".contacts-link",
    ".address-link",
    ".contact-link",
    ".header-contacts-link",
    ".header-address-link",
]


def find_contacts_links(page):
    """Знаходить контактні посилання за одним з можливих селекторів."""
    for selector in CONTACTS_LINK_SELECTORS:
        elements = page.query_selector_all(selector)
        if elements:
            return selector, elements
    return None, []


def check_contacts_padding(page_url: str) -> dict:
    """
    Перевіряє, що контактні посилання в хедері
    не мають вертикальних паддінгів на планшетному брейкпойнті.

    Returns:
        dict з результатом перевірки:
        - passed: bool
        - message: str
        - details: list
    """
    result = {
        "passed": True,
        "message": "",
        "details": [],
    }

    with sync_playwright() as p:
        browser = p.chromium.launch()
        context = browser.new_context(
            viewport={"width": TABLET_WIDTH, "height": TABLET_HEIGHT}
        )
        page = context.new_page()
        page.goto(page_url, wait_until="networkidle")

        selector, links = find_contacts_links(page)

        if not links:
            result["passed"] = False
            result["message"] = (
                "Не знайдено контактних посилань у хедері. "
                f"Перевірені селектори: {', '.join(CONTACTS_LINK_SELECTORS)}"
            )
            browser.close()
            return result

        for i, link in enumerate(links):
            text = link.inner_text().strip()
            styles = link.evaluate(
                """el => {
                    const cs = window.getComputedStyle(el);
                    return {
                        paddingTop: cs.paddingTop,
                        paddingBottom: cs.paddingBottom,
                        paddingTopPx: parseFloat(cs.paddingTop),
                        paddingBottomPx: parseFloat(cs.paddingBottom),
                    };
                }"""
            )

            pt = styles["paddingTopPx"]
            pb = styles["paddingBottomPx"]

            if pt > 0 or pb > 0:
                result["passed"] = False
                result["details"].append(
                    {
                        "element": f'{selector} [{i}] "{text}"',
                        "padding_top": styles["paddingTop"],
                        "padding_bottom": styles["paddingBottom"],
                    }
                )

        browser.close()

    if result["passed"]:
        result["message"] = (
            f"✅ PASSED: Контактні посилання ({selector}) на {TABLET_WIDTH}px "
            "не мають вертикальних паддінгів."
        )
    else:
        details_str = "\n".join(
            f'   • {d["element"]}: '
            f'padding-top={d["padding_top"]}, padding-bottom={d["padding_bottom"]}'
            for d in result["details"]
        )
        result["message"] = (
            f"❌ FAILED: Контактні посилання ({selector}) на {TABLET_WIDTH}px "
            f"мають вертикальні паддінги, що збільшує висоту хедера.\n"
            f"{details_str}\n"
            f"   Очікувано: padding-top: 0px, padding-bottom: 0px"
        )

    return result


if __name__ == "__main__":
    import sys

    url = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:5500/index.html"
    result = check_contacts_padding(url)
    print(result["message"])
    sys.exit(0 if result["passed"] else 1)
